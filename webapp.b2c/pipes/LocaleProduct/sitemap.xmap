<?xml version="1.0"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<map:components>
		<map:transformers default="xslt">
			<map:transformer name="shell" src="org.apache.cocoon.transformation.FileActionsTransformer"/>
		</map:transformers>
		<map:actions>
			<map:action name="synced-copy-source" src="org.apache.cocoon.acting.SyncedCopySourceAction"/>
		</map:actions>
	</map:components>
	<map:pipelines>
		<!--- -->
		<map:component-configurations>
			<global-variables>
				<ldir>PerformanceLogging/</ldir>
				<channel>PerformanceLogging</channel>
			</global-variables>
		</map:component-configurations>
		<!--- -->
		<map:pipeline name="LocaleProduct" type="noncaching">
			<map:match pattern="get">
				<map:generate src="../common/xml/empty.xml"/>
				<map:transform type="xslt-saxon" src="./xsl/sql_getProducts.xsl" label="step1">
					<map:parameter name="locale" value="{request-param:locale}"/>
					<map:parameter name="ctnList" value="{request-param:ctnList}"/>
				</map:transform>
				<!--- -->
				<map:transform type="sql" label="step2">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<!--- -->
				<map:transform type="xslt-saxon" src="./xsl/determineMissingProducts.xsl" label="step2b">
					<map:parameter name="ctnList" value="{request-param:ctnList}"/>
				</map:transform>
				<!--- -->
				<map:transform type="xslt-saxon" src="./xsl/sql_retrieveMissingProducts.xsl" label="step2c">
					</map:transform>
				<!--- -->
				<map:transform type="sql" label="step2d">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<!--- -->
				<map:transform type="xslt-saxon" src="./xsl/cleanupProducts.xsl" label="step2c">
					</map:transform>
				<map:transform type="xslt-saxon" src="xsl/convertProducts.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="getDates">
				<map:generate src="cocoon:/get"/>
				<map:transform type="xslt-saxon" src="xsl/getDates.xsl" label="step3">
					<map:parameter name="reportDate" value="{date:yyyy-MM-dd}T{date:HH:mm:ss}"/>
				</map:transform>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="createPerformanceReport">
				<map:act type="copy-source" src="cocoon:/createLogCounts">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}logs/createLogCounts-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:generate src="cocoon:/getDates?locale=en_MY&amp;ctnList=42PFL1000D/00"/>
				<map:transform type="xslt-saxon" src="xsl/makestats.xsl" label="step6">
					<map:parameter name="channel" value="{global:channel}"/>
					<map:parameter name="dir" value="{global:gdir}{global:ldir}"/>
					<!--map:parameter name="exportdate" value="{date:yyyyMMdd}T{date:HHmmss}"/-->
					<map:parameter name="exportdate" value="{date:yyyyMMdd}"/>
				</map:transform>
				<!-- write to disk -->
				<map:transform type="write-source" label="step7"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="showPerformanceReport">
				<map:generate type="xpathdirectory" src="{global:gdir}{global:ldir}stats">
					<map:parameter name="xpath" value="/report"/>
					<map:parameter name="xmlFiles" value="Report.*\.xml$"/>
				</map:generate>
				<map:transform type="xslt-saxon" src="xsl/dir2report.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="showLogCounts">
				<map:generate type="xpathdirectory" src="{global:gdir}{global:ldir}stats">
					<map:parameter name="xpath" value="/root/count"/>
					<map:parameter name="xmlFiles" value="counts.*\.xml$"/>
				</map:generate>
				<map:transform type="xslt-saxon" src="xsl/dir2report.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="createLogCounts">
				<!-- Set Start Time.of this channel-->
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT01-PMA_Raw">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT01-PMA_Raw-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT02-PMS_Raw">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT02-PMS_Raw-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT03-PMT_Raw">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT03-PMT_Raw-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT04-AssetList">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT04-AssetList-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT05-ObjectAssetList">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT05-ObjectAssetList-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT10-PMT_Enriched">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT10-PMT_Enriched-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT20-PMT_Master">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT20-PMT_Master-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT40-PMT_Localised">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT40-PMT_Localised-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT41-PMT_Translated">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT41-PMT_Translated-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT42-PMA">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT42-PMA-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT50-PMT">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT50-PMT-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT52-PCT_Raw">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT52-PCT_Raw-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT53-PCT_Master">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT53-PCT_Master-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT54-PCT_Translated">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT54-PCT_Translated-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT55-PCT">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT55-PCT-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT70-PMS">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT70-PMS-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT90-AtgExport">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT90-AtgExport-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/logArchiveSize-PMT91-AtgExport">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT91-AtgExportSize-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/readLogFiles-PMT92-CareAtgExport">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT92-CareAtgExport-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:act type="copy-source" src="cocoon:/logArchiveSize-PMT93-CareAtgExport">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}stats/counts-PMT93-CareAtgExportSize-{date:yyyyMMdd}.xml"/>
				</map:act>
				<map:generate type="directory" src="{global:gdir}{global:ldir}/stats">
					<map:parameter name="dateFormat" value="yyyy-MM-dd hh:mm"/>
					<map:parameter name="depth" value="1"/>
					<map:parameter name="include" value=".*\.xml$"/>
				</map:generate>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="readLogFiles-*-**">
				<map:generate type="directory" src="{global:gdir}{2}/logs">
					<map:parameter name="dateFormat" value="yyyyMMddHHmmss"/>
					<map:parameter name="depth" value="1"/>
					<map:parameter name="include" value=".*\.xml$"/>
				</map:generate>
				<map:transform src="xsl/dir2pipeline.xsl" label="stepD2">
					<map:parameter name="pipeline" value="logReportCount-{1}-{2}-"/>
				</map:transform>
				<map:transform type="cinclude"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="readLogFiles1-*-**">
				<map:generate type="directory" src="{global:gdir}{2}/logs">
					<map:parameter name="dateFormat" value="yyyyMMddHHmmss"/>
					<map:parameter name="depth" value="1"/>
					<map:parameter name="include" value=".*\.xml$"/>
				</map:generate>
				<map:transform src="xsl/dir2pipeline.xsl" label="stepD2">
					<map:parameter name="pipeline" value="logReportCount-{1}-{2}-"/>
				</map:transform>
				<!--map:transform type="cinclude"/-->
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="logReportCount-*-*-*-**">
				<map:generate src="{global:gdir}{2}/logs/{3}"/>
				<map:transform src="xsl/report-count.xsl" label="stepD2">
					<map:parameter name="order" value="{1}"/>
					<map:parameter name="channel" value="{2}"/>
					<map:parameter name="logfile" value="{3}"/>
					<map:parameter name="finish" value="{4}"/>
				</map:transform>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="logArchiveSize-*-*">
				<map:aggregate element="root">
					<map:part src="cocoon:/logArchiveSizeSub-{1}-{2}-archive"/>
					<map:part src="cocoon:/logArchiveSizeSub-{1}-{2}-archive_ftp"/>
					<map:part src="cocoon:/logArchiveSizeSub-{1}-{2}-processed"/>
				</map:aggregate>
				<map:transform type="xslt-saxon" src="xsl/report-size-clean.xsl"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="logArchiveSizeSub-*-*-**">
				<map:generate type="directory" src="{global:gdir}{2}/{3}/">
					<map:parameter name="dateFormat" value="yyyy-MM-dd hh:mm"/>
					<map:parameter name="depth" value="5"/>
				</map:generate>
				<map:transform type="xslt-saxon" src="xsl/report-size.xsl" label="stepD2">
					<map:parameter name="order" value="{1}"/>
					<map:parameter name="channel" value="{2}"/>
					<map:parameter name="logfile" value="{3}"/>
					<map:parameter name="finish" value=""/>
				</map:transform>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="filestore_list_doctypes">
				<map:generate type="directory" src="{cmc2:clobFilestoreDir}">
					<map:parameter name="dateFormat" value="yyyy-MM-dd HH:mm"/>
					<map:parameter name="depth" value="1"/>
				</map:generate>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="filestore_list_locales-*">
				<map:generate type="directory" src="{cmc2:clobFilestoreDir}/{1}">
					<map:parameter name="dateFormat" value="yyyy-MM-dd HH:mm"/>
					<map:parameter name="depth" value="1"/>
				</map:generate>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="filestore_list_files-*-*-**">
				<map:generate type="directory" src="{cmc2:clobFilestoreDir}/{1}/{2}">
					<map:parameter name="dateFormat" value="yyyy-MM-dd HH:mm"/>
					<map:parameter name="depth" value="1"/>
					<map:parameter name="include" value="{3}"/>
				</map:generate>
				<map:transform type="xslt-saxon" src="xsl/dir2filelist.xsl" label="stepD2">
					<map:parameter name="channel" value="{1}"/>
					<map:parameter name="locale" value="{2}"/>
					<map:parameter name="filepart" value="{3}"/>
				</map:transform>
				<map:serialize type="html"/>
			</map:match>
			<!--- -->
			<map:match pattern="filestore_getfile-**">
				<map:generate src="{cmc2:clobFilestoreDir}/{1}"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="getLocales">
				<map:generate src="../common/xml/empty.xml"/>
				<map:transform type="xslt-saxon" src="./xsl/sql_getLocales.xsl" label="step1">
					<map:parameter name="locale" value="{request-param:locale}"/>
				</map:transform>
				<map:transform type="sql" label="step2">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="xsl/convertLocales.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!--- -->
			<map:match pattern="test">
				<map:generate type="request"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="stream">
				<map:generate type="stream"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="stream2">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="request">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:transform type="xslt-saxon" src="./xsl/sql_getProducts1.xsl" label="step1">
					<map:parameter name="locale" value="{request-param:locale}"/>
					<map:parameter name="ctnList" value="{request-param:ctnList}"/>
				</map:transform>
				<map:transform type="sql" label="step2">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="./xsl/determineMissingProducts1.xsl" label="step2b">
					<map:parameter name="ctnList" value="{request-param:ctnList}"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="./xsl/sql_retrieveMissingProducts.xsl" label="step2c">
					</map:transform>
				<map:transform type="sql" label="step2d">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="./xsl/cleanupProducts.xsl" label="step2c">
					</map:transform>
				<map:transform type="xslt-saxon" src="xsl/convertProducts.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="requestLocale">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:transform type="xslt-saxon" src="./xsl/sql_getLocales1.xsl" label="step1">
				</map:transform>
				<map:transform type="sql" label="step2">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="xsl/convertLocales.xsl" label="step3"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="deleteTempFiles">
				<!-- Delete all files in temp directory -->
				<!-- Retrieve all files in temp directory -->
				<map:generate type="directory" src="{global:gdir}{global:ldir}temp">
					<map:parameter name="dateFormat" value="yyyy-MM-dd hh:mm"/>
					<map:parameter name="depth" value="1"/>
					<map:parameter name="include" value=".*"/>
				</map:generate>
				<!-- Delete all files -->
				<map:transform src="xsl/dir2shell_delete.xsl">
					<map:parameter name="dir" value="{global:gdir}{global:ldir}temp"/>
				</map:transform>
				<map:transform type="shell"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
		</map:pipeline>
	</map:pipelines>
	<!-- -->
	<map:views>
		<map:view name="step1" from-label="step1">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step2" from-label="step2">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step3" from-label="step3">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step4" from-label="step4">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step5" from-label="step5">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step6" from-label="step6">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step7" from-label="step7">
			<map:serialize type="xml"/>
		</map:view>
	</map:views>
</map:sitemap>
