<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">
	<!-- -->
	<map:components>
		<map:transformers default="xslt">
			<map:transformer name="webservice" src="org.apache.cocoon.transformation.AxisTransformer"/>
			<map:transformer name="shell" src="org.apache.cocoon.transformation.FileActionsTransformer"/>
		</map:transformers>
		<map:actions>
			<map:action name="synced-copy-source" src="org.apache.cocoon.acting.SyncedCopySourceAction"/>
		</map:actions>
	</map:components>
	<!-- -->
	<map:pipelines>
		<!--- -->
		<map:component-configurations>
			<global-variables>
				<ldir>TestMDM_Soap/</ldir>
				<channel>TestMDM_Soap</channel>
				<count>10</count>
			</global-variables>
		</map:component-configurations>
		<!-- -->
		<map:pipeline name="{global:channel}" type="noncaching">
			<!-- -->
			<map:match pattern="runPipeline">
				<!-- This is the starting point of the pipeline. A lock is requested to prevent this pipeline from running multiple times in parallel.
				When a lock cannot be acquired, an error message is shown. If a lock can be acquired, run exportMain -->
				<map:act type="synced-copy-source" src="cocoon:/importStart">
					<map:parameter name="lockName" value="{global:channel}"/>
					<map:parameter name="dest" value="{global:gdir}{global:ldir}temp/importMainReport.xml"/>
					<map:generate src="{global:gdir}{global:ldir}temp/importMainReport.xml"/>
					<map:serialize type="xml"/>
				</map:act>
				<map:generate src="../common/xml/locked.xml"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="importStart">
				<!-- Set Start Time.of this channel-->
				<map:act type="copy-source" src="cocoon:/runsql_setstarttime">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}temp/ReportSetStartTime.xml"/>
				</map:act>
				<!-- Call the Main Import.-->
				<map:act type="copy-source" src="cocoon:/importMain">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}archive/ReportTime-{date:yyyyMMdd}T{date:hhmmss}.xml"/>
				</map:act>
				<!-- Set End Time of this channel-->
				<map:act type="copy-source" src="cocoon:/runsql_setendtime">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}temp/ReportSetEndTime.xml"/>
				</map:act>
				<!-- Show result -->
				<map:act type="copy-source" src="cocoon:/runsql_gettimings">
					<map:parameter name="dest" value="{global:gdir}{global:ldir}temp/ReportGetTimings.xml"/>
				</map:act>
				<map:generate src="{global:gdir}{global:ldir}temp/ReportGetTimings.xml"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- set Start / End Time -->
			<map:match pattern="runsql_*">
				<map:generate src="../common/xml/empty.xml"/>
				<map:transform type="xslt-saxon" src="../common/xsl/{global:db}sql_{1}.xsl">
					<map:parameter name="channel" value="{global:channel}"/>
              <map:parameter name="run_id" value="{request-param:runId}"/>
              <map:parameter name="run_mode" value="{request-param:runmode}"/>
				</map:transform>
				<!-- Run db queries -->
				<map:transform type="sql">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<!-- -->
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="importMain">
				<map:generate src="cocoon:/importMain_{date:yyyy-MM-dd}T{date:HH:mm:ss.SSS'Z'}"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="importMain_*">
				<map:generate src="xml/soap_request.xml" label="step1"/>
				<map:transform type="xslt-saxon" src="xsl/soap_requests.xsl" label="step2">
					<map:parameter name="count" value="{global:count}"/>
				</map:transform>
				<map:transform type="include" label="step3"/>
				<map:transform type="xslt-saxon" src="xsl/calctime.xsl" label="step4">
					<map:parameter name="begintime" value="{1}"/>
					<map:parameter name="endtime" value="{date:yyyy-MM-dd}T{date:HH:mm:ss.SSS'Z'}"/>
					<map:parameter name="count" value="{global:count}"/>
				</map:transform>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="ExecuteSoapCall">
				<map:generate src="xml/MDM_test_query.xml" label="step1"/>
				<map:transform type="webservice" label="step2"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="test">
				<map:generate src="xml/soap_request.xml" label="step1"/>
				<map:transform type="webservice" label="step2"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="createAllProductsInMDM">
				<map:generate src="cocoon:/createAllProductsInMDM_{date:yyyy-MM-dd}T{date:HH:mm:ss.SSS'Z'}"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="createAllProductsInMDM_*">
				<map:generate src="xml/sql_getallctns.xml" label="step1"/>
				<!-- Run db queries -->
				<map:transform type="sql" label="step2">
					<map:parameter name="use-connection" value="oracleDbCMC"/>
					<map:parameter name="clob-encoding" value="UTF-8"/>
				</map:transform>
				<map:transform type="xslt-saxon" src="xsl/ctn2include.xsl" label="step3">
					<map:parameter name="count" value="{global:count}"/>
				</map:transform>
				<map:transform type="include" label="step4"/>
				<map:transform type="xslt-saxon" src="xsl/calctime.xsl" label="step5">
					<map:parameter name="begintime" value="{1}"/>
					<map:parameter name="endtime" value="{date:yyyy-MM-dd}T{date:HH:mm:ss.SSS'Z'}"/>
					<map:parameter name="count" value="8107"/>
				</map:transform>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="createProductInMDM.**">
				<map:generate src="../common/xml/empty.xml" label="step1"/>
				<map:transform type="xslt-saxon" src="xsl/create_ctn.xsl" label="step3">
					<map:parameter name="ctn" value="{1}"/>
				</map:transform>
				<!--map:transform type="webservice" label="step2"/-->
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
			<map:match pattern="execute_**">
				<map:generate src="xml/{1}.xml" label="step1"/>
				<map:transform type="webservice" label="step2"/>
				<map:serialize type="xml"/>
			</map:match>
			<!-- -->
		</map:pipeline>
	</map:pipelines>
	<!-- -->
	<map:views>
		<map:view name="step1" from-label="step1">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step2" from-label="step2">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step3" from-label="step3">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step4" from-label="step4">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step5" from-label="step5">
			<map:serialize type="xml"/>
		</map:view>
		<map:view name="step6" from-label="step6">
			<map:serialize type="xml"/>
		</map:view>
	</map:views>
	<!-- -->
</map:sitemap>
