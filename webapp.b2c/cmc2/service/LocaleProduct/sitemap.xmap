<?xml version="1.0"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

	<map:resources>
		<map:resource name="sql">
			<map:transform type="sql">
				<map:parameter name="use-connection" value="oracleDbCMC"/>
				<map:parameter name="clob-encoding" value="UTF-8"/>
			</map:transform>
		</map:resource>
	</map:resources>

	
	<map:pipelines>
		<!--- -->
		<map:pipeline name="LocaleProduct" type="noncaching">
			<map:match pattern="get">
				<map:generate src="{cmc2:xmlDir}/empty.xml"/>
				<map:transform  src="xsl/sql_getProducts.xsl" >
					<map:parameter name="locale" value="{request-param:locale}"/>
						<map:parameter name="ctnList" value="{request-param:ctnList}"/>
					</map:transform>
				<map:call resource="sql"/>
				<map:transform src="xsl/convertProducts.xsl"/>
				<map:serialize type="xml"/>
			</map:match>
			
			<map:match pattern="getLocales">
				<map:generate src="{cmc2:xmlDir}/empty.xml"/>
				<map:transform src="xsl/sql_getLocales.xsl">
						<map:parameter name="locale" value="{request-param:locale}"/>
				</map:transform>
				<map:call resource="sql"/>
				<map:transform src="xsl/convertLocales.xsl"/>
				<map:serialize type="xml"/>
			</map:match>

			<map:match pattern="test">
				<map:generate type="request"/>
				<map:serialize type="xml"/>
			</map:match>
			
			<map:match pattern="stream">
				<map:generate type="stream"/>
				<map:serialize type="xml"/>
			</map:match>
			<map:match pattern="stream2">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:serialize type="xml"/>
			</map:match>
			<map:match pattern="request">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:transform src="xsl/sql_getProducts1.xsl" >
					<map:parameter name="locale" value="{request-param:locale}"/>
					<map:parameter name="ctnList" value="{request-param:ctnList}"/>
				</map:transform>
				<map:call resource="sql"/>
				<map:transform src="xsl/convertProducts.xsl"/>
				<map:serialize type="xml"/>
			</map:match>			
			<map:match pattern="requestLocale">
				<map:generate type="file" src="module:request:inputStream"/>
				<map:transform type="xslt-saxon" src="xsl/sql_getLocales1.xsl"/>
				<map:call resource="sql"/>
				<map:transform src="xsl/convertLocales.xsl"/>
				<map:serialize type="xml"/>
			</map:match>			
		</map:pipeline>
		<!-- -->
	</map:pipelines>
</map:sitemap>
