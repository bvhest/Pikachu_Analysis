<?xml version="1.0" encoding="UTF-8"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

  <map:resources>
    <!-- the sql resource provides a central place to edit database details -->
    <map:resource name="sql">
      <map:transform type="sql">
        <map:parameter name="use-connection" value="oracleDbCMC"/>
        <map:parameter name="clob-encoding" value="UTF-8"/>
      </map:transform>
    </map:resource>
  </map:resources>

  <map:components>
    <map:transformers>
      <map:transformer name="sendmail" src="org.apache.cocoon.mail.transformation.SendMailTransformer">
        <smtphost>nlvg020.gdc1.ce.philips.com</smtphost>
        <smtpport>25</smtpport>
      </map:transformer>
    </map:transformers>        
    <map:selectors>
      <map:selector name="parameter" logger="sitemap.selector.parameter" src="org.apache.cocoon.selection.ParameterSelector"/>
    </map:selectors>
  </map:components>  
  
  
  <map:pipelines>

    <map:component-configurations>
      <global-variables>
        <ct>Jobs</ct>
      </global-variables>
    </map:component-configurations>

    <map:pipeline type="noncaching">
      <map:match pattern="runMain/*">
        <map:select type="parameter">
          <map:parameter name="parameter-selector-test" value="{request-param:includefile}"/>    
          <map:when test="">       
            <!-- Do nothing if cincludefile = '' -->
            <map:generate src="xsl/no_include.xml"/>
          </map:when>
          <map:otherwise>
            <!-- Only run if cincludefile != '' -->
            <map:act type="copy-source" src="cocoon:/include/{1}">
              <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/main_report.xml"/>
            </map:act>
            <map:generate src="{cmc2:gdir}/{global:ct}/temp/main_report.xml"/>
          </map:otherwise>
        </map:select>                    
        <map:serialize type="xml"/>
      </map:match>

      <map:match pattern="include/*">
        <map:generate src="{cmc2:xmlDir}/empty.xml"/>
        <map:transform type="xslt-saxon" src="xsl/include.xsl">
          <map:parameter name="ct" value="{global:ct}"/>
          <map:parameter name="ts" value="{1}"/>
          <map:parameter name="includefile" value="{request-param:includefile}"/>
          <map:parameter name="usefullpath" value="{request-param:usefullpath}"/>
          <map:parameter name="guidir" value="{cmc2:guiDir}"/>
        </map:transform>
        <map:transform type="cinclude"/>
        <map:serialize type="xml"/>
      </map:match>


      
    </map:pipeline>
  </map:pipelines>
</map:sitemap>
