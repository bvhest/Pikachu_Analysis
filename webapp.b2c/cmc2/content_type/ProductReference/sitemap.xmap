<?xml version="1.0" encoding="UTF-8"?>
<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

  <map:resources>
    <map:resource name="sql">
      <map:transform type="sql">
        <map:parameter name="use-connection" value="oracleDbCMC"/>
        <map:parameter name="clob-encoding" value="UTF-8"/>
      </map:transform>
    </map:resource>
  </map:resources>
  <!-- -->
  <map:pipelines>
    <map:component-configurations>
      <global-variables>
        <ct>ProductReference</ct>
      </global-variables>
    </map:component-configurations>
    <!-- -->
    <map:pipeline type="noncaching">
     
      <map:match pattern="runMain/*">
       
        <map:act type="copy-source" src="cocoon:/preProcess/{1}">
          <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/preProcess_report.xml"/>
        </map:act>
        
        <!--map:act type="copy-source" src="cocoon:/PostProcess/batch/import/processFiles/{global:ct}/{1}">        
          <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/processBatches_report.xml"/>
        </map:act-->      

        <map:act type="copy-source" src="{cmc2:svcURL}/store/mergeDeltaSave.{global:ct}/batch/import/processFiles/{global:ct}/{1}?reload=false">
          <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/processFiles_report.xml"/>
        </map:act>
	
		    
        <map:act type="copy-source" src="{cmc2:svcURL}/processControl/archiveFiles/outbox/{global:ct}">
          <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/archive_out_report.xml"/>
        </map:act>
        <map:act type="copy-source" src="{cmc2:svcURL}/processControl/archiveFiles/inbox/{global:ct}">
          <map:parameter name="dest" value="{cmc2:gdir}/{global:ct}/temp/archive_in_report.xml"/>
        </map:act>
		
        <map:generate src="{cmc2:gdir}/{global:ct}/temp/processFiles_report.xml"/>
        <map:serialize type="xml"/>
      </map:match>
   
	  
     <map:match pattern="preProcess/*">
	    <map:generate type="directory" src="{cmc2:gdir}/{global:ct}/outbox">
          <map:parameter name="depth" value="1"/>
          <map:parameter name="include" value="ProductReferences.*\.xml"/>
        </map:generate>
         <map:transform  src="xsl/include_dir2preProcessFile.xsl">
          <map:parameter name="ct" value="{global:ct}"/>
          <map:parameter name="timestamp" value="{1}"/>
          <map:parameter name="dir" value="{cmc2:gdir}/{global:ct}/outbox/"/>
          <map:parameter name="prefix" value="zz"/>
        </map:transform>
        <map:transform type="cinclude"/>
        <map:serialize type="xml"/>
      </map:match>
	  
     <map:match pattern="preProcessFile/*/**.*">
        <map:generate src="{cmc2:gdir}/{global:ct}/outbox/{2}.{3}"/>
		<map:transform  src="xsl/processRules.xsl"/>
		<map:call resource="sql"/>

		<map:transform  src="xsl/formatRules.xsl"/>

		<map:transform  src="xsl/groupCTNs.xsl"/>
  
		<map:transform  src="xsl/writeObjects.xsl">
			<map:parameter name="dir" value="{cmc2:gdir}/{global:ct}/inbox/"/>
			<map:parameter name="ts" value="{1}"/>
		 </map:transform>
		<map:transform type="write-source"/>
		<map:serialize type="xml"/>
      </map:match>



 
	  <!-- -->
    </map:pipeline>
  </map:pipelines>
</map:sitemap>
